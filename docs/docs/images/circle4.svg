<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 960 960" font-family="'Segoe UI', system-ui, sans-serif">
  <defs>
    <linearGradient id="kelGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#2dd4bf" stop-opacity="0.15"/>
      <stop offset="100%" stop-color="#2dd4bf" stop-opacity="0.05"/>
    </linearGradient>
    <linearGradient id="seqGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#f59e0b" stop-opacity="0.15"/>
      <stop offset="100%" stop-color="#f59e0b" stop-opacity="0.05"/>
    </linearGradient>
    <!-- indigo arrow for global sequence -->
    <marker id="arrow" viewBox="0 0 10 7" refX="10" refY="3.5"
            markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6366f1"/>
    </marker>
    <!-- rose arrow for key rotation chains -->
    <marker id="rotArrow" viewBox="0 0 10 7" refX="10" refY="3.5"
            markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <polygon points="0 0, 10 3.5, 0 7" fill="#f43f5e"/>
    </marker>
  </defs>

  <rect width="960" height="960" fill="#1e1e2e" rx="16"/>

  <text x="480" y="45" text-anchor="middle" fill="#cdd6f4"
        font-size="22" font-weight="600">Kel-Circle Protocol</text>
  <text x="480" y="70" text-anchor="middle" fill="#6c7086"
        font-size="13">5 members + 1 sequencer · global sequence</text>

  <!-- Subtle circle outline, center=(480,490), r=310 -->
  <circle cx="480" cy="490" r="310" fill="none"
          stroke="#313244" stroke-width="1" stroke-dasharray="4,8" opacity="0.4"/>

  <!-- ============================================================ -->
  <!-- 6 KELs on the circle, 60° apart.                             -->
  <!-- icp at outer end, newest event closest to center.             -->
  <!--                                                               -->
  <!-- Event colors:                                                 -->
  <!--   icp = teal    (#2dd4bf / #94e2d5)                           -->
  <!--   rot = rose    (#f43f5e / #fda4af)                           -->
  <!--   ixn = indigo  (#6366f1 / #a5b4fc)                           -->
  <!--                                                               -->
  <!-- Positions (angle from top, clockwise):                        -->
  <!--   S:  0°  (480, 180)  rot=180°  — Sequencer (amber)          -->
  <!--   A: 60°  (748, 335)  rot=240°  — has 1 rot                  -->
  <!--   B: 120° (748, 645)  rot=300°                                -->
  <!--   C: 180° (480, 800)  rot=0°    — has 1 rot                  -->
  <!--   D: 240° (212, 645)  rot=60°                                 -->
  <!--   E: 300° (212, 335)  rot=120°  — has 2 rots                 -->
  <!--                                                               -->
  <!-- Global sequence assignment:                                   -->
  <!--   1:A  2:B  3:S  4:D  5:C  6:S  7:A  8:B  9:E               -->
  <!--   S emits ixn 3 (timeout) and ixn 6 (threshold)              -->
  <!-- ============================================================ -->

  <!-- ===== Sequencer S (0°, top) — amber, rotated 180° ===== -->
  <!-- Events: icp, ixn 3, ixn 6 — server-emitted decisions -->
  <!-- Local coords with rot=180°: world_y = 180 - local_y -->
  <!--   icp:   local y=-72 → world (480, 252)                -->
  <!--   ixn 3: local y=-40 → world (480, 220)                -->
  <!--   ixn 6: local y=-8  → world (480, 188)                -->
  <g transform="translate(480,180) rotate(180)">
    <rect x="-32" y="-95" width="64" height="190" rx="10"
          fill="url(#seqGrad)" stroke="#f59e0b" stroke-width="1.5"/>
    <!-- icp -->
    <rect x="-24" y="-85" width="48" height="26" rx="4"
          fill="#f59e0b" fill-opacity="0.25"/>
    <text x="0" y="-67" text-anchor="middle" fill="#fcd34d"
          font-size="10" transform="rotate(180,0,-72)">icp</text>
    <!-- ixn 3 (server-emitted: timeout decision) -->
    <rect x="-24" y="-53" width="48" height="26" rx="4"
          fill="#6366f1" fill-opacity="0.3"/>
    <text x="0" y="-35" text-anchor="middle" fill="#a5b4fc"
          font-size="10" transform="rotate(180,0,-40)">ixn 3</text>
    <!-- ixn 6 (server-emitted: threshold decision) -->
    <rect x="-24" y="-21" width="48" height="26" rx="4"
          fill="#6366f1" fill-opacity="0.3"/>
    <text x="0" y="-3" text-anchor="middle" fill="#a5b4fc"
          font-size="10" transform="rotate(180,0,-8)">ixn 6</text>
    <!-- label -->
    <text x="0" y="25" text-anchor="middle" fill="#f59e0b"
          font-size="11" font-weight="700"
          transform="rotate(180,0,20)">S</text>
  </g>

  <!-- ===== Member A (60°, top-right) — has 1 rot ===== -->
  <!-- Events: icp, ixn 1, rot, ixn 7 — 4 slots -->
  <!-- Local coords with rot=240° (cos=-0.5, sin=-0.866): -->
  <!--   ixn 1: local (0,-56) → world (748 + 56*(-0.866), 335 + 56*(-0.5)) -->
  <!--        = (748 - 48.5, 335 - 28) = (700, 307)                          -->
  <!--   ixn 7: local (0,24)  → world (748 - 24*(-0.866), 335 - 24*(-0.5)) -->
  <!--        = (748 + 20.8, 335 + 12) ... wait let me redo                  -->
  <!-- For translate(tx,ty) rotate(θ): world = (tx + x*cosθ - y*sinθ,       -->
  <!--                                          ty + x*sinθ + y*cosθ)        -->
  <!-- rot=240°: cos=-0.5, sin=-0.866                                        -->
  <!--   (0, -56): world = (748 - (-56)*(-0.866), 335 + (-56)*(-0.5))       -->
  <!--           = (748 - 48.5, 335 + 28) = (700, 363)                      -->
  <!--   (0, -24): world = (748 - (-24)*(-0.866), 335 + (-24)*(-0.5))       -->
  <!--           = (748 - 20.8, 335 + 12) = (727, 347)                      -->
  <!--   (0, 8):   world = (748 - 8*(-0.866), 335 + 8*(-0.5))              -->
  <!--           = (748 + 6.9, 335 - 4) = (755, 331)                        -->
  <!--   (0, 40):  world = (748 - 40*(-0.866), 335 + 40*(-0.5))            -->
  <!--           = (748 + 34.6, 335 - 20) = (783, 315)                      -->
  <g transform="translate(748,335) rotate(240)">
    <rect x="-32" y="-95" width="64" height="190" rx="10"
          fill="url(#kelGrad)" stroke="#2dd4bf" stroke-width="1.5"/>
    <!-- icp at local center y=-72 → world ≈ (686, 371) -->
    <rect x="-24" y="-85" width="48" height="26" rx="4"
          fill="#2dd4bf" fill-opacity="0.3"/>
    <text x="0" y="-67" text-anchor="middle" fill="#94e2d5"
          font-size="10" transform="rotate(120,0,-72)">icp</text>
    <!-- ixn 1 at local center y=-40 → world ≈ (713, 355) -->
    <rect x="-24" y="-53" width="48" height="26" rx="4"
          fill="#6366f1" fill-opacity="0.3"/>
    <text x="0" y="-35" text-anchor="middle" fill="#a5b4fc"
          font-size="10" transform="rotate(120,0,-40)">ixn 1</text>
    <!-- rot at local center y=-8 → world ≈ (741, 339) -->
    <rect x="-24" y="-21" width="48" height="26" rx="4"
          fill="#f43f5e" fill-opacity="0.3"/>
    <text x="0" y="-3" text-anchor="middle" fill="#fda4af"
          font-size="10" transform="rotate(120,0,-8)">rot</text>
    <!-- ixn 7 at local center y=24 → world ≈ (769, 323) -->
    <rect x="-24" y="11" width="48" height="26" rx="4"
          fill="#6366f1" fill-opacity="0.3"/>
    <text x="0" y="29" text-anchor="middle" fill="#a5b4fc"
          font-size="10" transform="rotate(120,0,24)">ixn 7</text>
    <!-- label -->
    <text x="0" y="60" text-anchor="middle" fill="#2dd4bf"
          font-size="11" font-weight="600"
          transform="rotate(120,0,55)">A</text>
  </g>

  <!-- ===== Member B (120°, bottom-right) — no rot ===== -->
  <!-- Events: icp, ixn 2, ixn 8 -->
  <!-- rot=300°: cos=0.5, sin=-0.866 -->
  <!--   local (0,-20) → world (748 - (-20)*(-0.866), 645 + (-20)*0.5) -->
  <!--                  = (748 - 17.3, 645 - 10) = (731, 635)           -->
  <!--   local (0,12)  → world (748 - 12*(-0.866), 645 + 12*0.5)       -->
  <!--                  = (748 + 10.4, 645 + 6) = (758, 651)            -->
  <g transform="translate(748,645) rotate(300)">
    <rect x="-32" y="-75" width="64" height="150" rx="10"
          fill="url(#kelGrad)" stroke="#2dd4bf" stroke-width="1.5"/>
    <rect x="-24" y="-65" width="48" height="26" rx="4"
          fill="#2dd4bf" fill-opacity="0.3"/>
    <text x="0" y="-47" text-anchor="middle" fill="#94e2d5"
          font-size="10" transform="rotate(60,0,-52)">icp</text>
    <!-- ixn 2 at local center y=-20 → world ≈ (731, 635) -->
    <rect x="-24" y="-33" width="48" height="26" rx="4"
          fill="#6366f1" fill-opacity="0.3"/>
    <text x="0" y="-15" text-anchor="middle" fill="#a5b4fc"
          font-size="10" transform="rotate(60,0,-20)">ixn 2</text>
    <!-- ixn 8 at local center y=12 → world ≈ (758, 651) -->
    <rect x="-24" y="-1" width="48" height="26" rx="4"
          fill="#6366f1" fill-opacity="0.3"/>
    <text x="0" y="17" text-anchor="middle" fill="#a5b4fc"
          font-size="10" transform="rotate(60,0,12)">ixn 8</text>
    <text x="0" y="48" text-anchor="middle" fill="#2dd4bf"
          font-size="11" font-weight="600"
          transform="rotate(60,0,43)">B</text>
  </g>

  <!-- ===== Member C (180°, bottom) — has 1 rot ===== -->
  <!-- Events: icp, rot, ixn 5 -->
  <!-- rot=0°: world = (480 + lx, 800 + ly) -->
  <!--   icp:   local center y=-56 → world (480, 744) -->
  <!--   rot:   local center y=-24 → world (480, 776) -->
  <!--   ixn 5: local center y=8   → world (480, 808) -->
  <g transform="translate(480,800) rotate(0)">
    <rect x="-32" y="-75" width="64" height="150" rx="10"
          fill="url(#kelGrad)" stroke="#2dd4bf" stroke-width="1.5"/>
    <!-- icp -->
    <rect x="-24" y="-65" width="48" height="26" rx="4"
          fill="#2dd4bf" fill-opacity="0.3"/>
    <text x="0" y="-47" text-anchor="middle" fill="#94e2d5"
          font-size="10">icp</text>
    <!-- rot -->
    <rect x="-24" y="-33" width="48" height="26" rx="4"
          fill="#f43f5e" fill-opacity="0.3"/>
    <text x="0" y="-15" text-anchor="middle" fill="#fda4af"
          font-size="10">rot</text>
    <!-- ixn 5 at local center y=12 → world (480, 812) -->
    <rect x="-24" y="-1" width="48" height="26" rx="4"
          fill="#6366f1" fill-opacity="0.3"/>
    <text x="0" y="17" text-anchor="middle" fill="#a5b4fc"
          font-size="10">ixn 5</text>
    <text x="0" y="48" text-anchor="middle" fill="#2dd4bf"
          font-size="11" font-weight="600">C</text>
  </g>

  <!-- ===== Member D (240°, bottom-left) — no rot ===== -->
  <!-- Events: icp, ixn 4 -->
  <!-- rot=60°: cos=0.5, sin=0.866 -->
  <!--   local (0,-20) → world (212 - (-20)*0.866, 645 + (-20)*0.5) -->
  <!--                  = (212 + 17.3, 645 - 10) = (229, 635)        -->
  <g transform="translate(212,645) rotate(60)">
    <rect x="-32" y="-75" width="64" height="150" rx="10"
          fill="url(#kelGrad)" stroke="#2dd4bf" stroke-width="1.5"/>
    <rect x="-24" y="-65" width="48" height="26" rx="4"
          fill="#2dd4bf" fill-opacity="0.3"/>
    <text x="0" y="-47" text-anchor="middle" fill="#94e2d5"
          font-size="10" transform="rotate(-60,0,-52)">icp</text>
    <!-- ixn 4 at local center y=-20 → world ≈ (229, 635) -->
    <rect x="-24" y="-33" width="48" height="26" rx="4"
          fill="#6366f1" fill-opacity="0.3"/>
    <text x="0" y="-15" text-anchor="middle" fill="#a5b4fc"
          font-size="10" transform="rotate(-60,0,-20)">ixn 4</text>
    <text x="0" y="20" text-anchor="middle" fill="#2dd4bf"
          font-size="11" font-weight="600"
          transform="rotate(-60,0,15)">D</text>
  </g>

  <!-- ===== Member E (300°, top-left) — has 2 rots ===== -->
  <!-- Events: icp, rot1, ixn 9, rot2 -->
  <!-- rot=120°: cos=-0.5, sin=0.866 -->
  <!--   local (0,-40) → world (212 - (-40)*0.866, 335 + (-40)*(-0.5)) -->
  <!--                  = (212 + 34.6, 335 + 20) = (247, 355)           -->
  <!--   local (0,-8)  → world (212 + 6.9, 335 + 4) = (219, 339)       -->
  <!--   local (0,24)  → world (212 - 20.8, 335 - 12) = (191, 323)     -->
  <g transform="translate(212,335) rotate(120)">
    <rect x="-32" y="-95" width="64" height="190" rx="10"
          fill="url(#kelGrad)" stroke="#2dd4bf" stroke-width="1.5"/>
    <!-- icp at local center y=-72 → world ≈ (274, 371) -->
    <rect x="-24" y="-85" width="48" height="26" rx="4"
          fill="#2dd4bf" fill-opacity="0.3"/>
    <text x="0" y="-67" text-anchor="middle" fill="#94e2d5"
          font-size="10" transform="rotate(-120,0,-72)">icp</text>
    <!-- rot 1 at local center y=-40 → world ≈ (247, 355) -->
    <rect x="-24" y="-53" width="48" height="26" rx="4"
          fill="#f43f5e" fill-opacity="0.3"/>
    <text x="0" y="-35" text-anchor="middle" fill="#fda4af"
          font-size="10" transform="rotate(-120,0,-40)">rot</text>
    <!-- ixn 9 at local center y=-8 → world ≈ (219, 339) -->
    <rect x="-24" y="-21" width="48" height="26" rx="4"
          fill="#6366f1" fill-opacity="0.3"/>
    <text x="0" y="-3" text-anchor="middle" fill="#a5b4fc"
          font-size="10" transform="rotate(-120,0,-8)">ixn 9</text>
    <!-- rot 2 at local center y=24 → world ≈ (191, 323) -->
    <rect x="-24" y="11" width="48" height="26" rx="4"
          fill="#f43f5e" fill-opacity="0.3"/>
    <text x="0" y="29" text-anchor="middle" fill="#fda4af"
          font-size="10" transform="rotate(-120,0,24)">rot</text>
    <!-- label -->
    <text x="0" y="60" text-anchor="middle" fill="#2dd4bf"
          font-size="11" font-weight="600"
          transform="rotate(-120,0,55)">E</text>
  </g>

  <!-- ============================================================ -->
  <!-- Global sequence: straight lines between ixn events            -->
  <!--                                                               -->
  <!-- Path: A(1)→B(2)→S(3)→D(4)→C(5)→S(6)→A(7)→B(8)→E(9)        -->
  <!--                                                               -->
  <!-- World coords of ixn centers:                                  -->
  <!--   A ixn1≈(713,355)  A ixn7≈(769,323)                         -->
  <!--   B ixn2≈(731,635)  B ixn8≈(758,651)                         -->
  <!--   S ixn3≈(480,220)  S ixn6≈(480,188)                         -->
  <!--   D ixn4≈(229,635)                                           -->
  <!--   C ixn5≈(480,812)                                           -->
  <!--   E ixn9≈(219,339)                                           -->
  <!-- ============================================================ -->

  <!-- 1→2: A(ixn1) → B(ixn2) -->
  <line x1="713" y1="355" x2="731" y2="635"
        stroke="#6366f1" stroke-width="1.2" stroke-dasharray="5,3"
        marker-end="url(#arrow)" opacity="0.5"/>
  <!-- 2→3: B(ixn2) → S(ixn3) -->
  <line x1="731" y1="635" x2="480" y2="220"
        stroke="#6366f1" stroke-width="1.2" stroke-dasharray="5,3"
        marker-end="url(#arrow)" opacity="0.5"/>
  <!-- 3→4: S(ixn3) → D(ixn4) -->
  <line x1="480" y1="220" x2="229" y2="635"
        stroke="#6366f1" stroke-width="1.2" stroke-dasharray="5,3"
        marker-end="url(#arrow)" opacity="0.5"/>
  <!-- 4→5: D(ixn4) → C(ixn5) -->
  <line x1="229" y1="635" x2="480" y2="812"
        stroke="#6366f1" stroke-width="1.2" stroke-dasharray="5,3"
        marker-end="url(#arrow)" opacity="0.5"/>
  <!-- 5→6: C(ixn5) → S(ixn6) -->
  <line x1="480" y1="812" x2="480" y2="188"
        stroke="#6366f1" stroke-width="1.2" stroke-dasharray="5,3"
        marker-end="url(#arrow)" opacity="0.5"/>
  <!-- 6→7: S(ixn6) → A(ixn7) -->
  <line x1="480" y1="188" x2="769" y2="323"
        stroke="#6366f1" stroke-width="1.2" stroke-dasharray="5,3"
        marker-end="url(#arrow)" opacity="0.5"/>
  <!-- 7→8: A(ixn7) → B(ixn8) -->
  <line x1="769" y1="323" x2="758" y2="651"
        stroke="#6366f1" stroke-width="1.2" stroke-dasharray="5,3"
        marker-end="url(#arrow)" opacity="0.5"/>
  <!-- 8→9: B(ixn8) → E(ixn9) -->
  <line x1="758" y1="651" x2="219" y2="339"
        stroke="#6366f1" stroke-width="1.2" stroke-dasharray="5,3"
        marker-end="url(#arrow)" opacity="0.5"/>

  <!-- Numbered sequence dots at each ixn event -->
  <g font-size="8" font-weight="700" text-anchor="middle" fill="#1e1e2e">
    <circle cx="713" cy="355" r="8" fill="#6366f1" opacity="0.8"/>
    <text x="713" y="358">1</text>
    <circle cx="731" cy="635" r="8" fill="#6366f1" opacity="0.8"/>
    <text x="731" y="638">2</text>
    <circle cx="480" cy="220" r="8" fill="#6366f1" opacity="0.8"/>
    <text x="480" y="223">3</text>
    <circle cx="229" cy="635" r="8" fill="#6366f1" opacity="0.8"/>
    <text x="229" y="638">4</text>
    <circle cx="480" cy="812" r="8" fill="#6366f1" opacity="0.8"/>
    <text x="480" y="815">5</text>
    <circle cx="480" cy="188" r="8" fill="#6366f1" opacity="0.8"/>
    <text x="480" y="191">6</text>
    <circle cx="769" cy="323" r="8" fill="#6366f1" opacity="0.8"/>
    <text x="769" y="326">7</text>
    <circle cx="758" cy="651" r="8" fill="#6366f1" opacity="0.8"/>
    <text x="758" y="654">8</text>
    <circle cx="219" cy="339" r="8" fill="#6366f1" opacity="0.8"/>
    <text x="219" y="342">9</text>
  </g>

  <!-- ============================================================ -->
  <!-- Key rotation chains: bezier curves icp→rot→rot within KELs   -->
  <!-- Rose colored, connecting key lifecycle events                 -->
  <!-- ============================================================ -->

  <!-- A: icp→rot -->
  <!-- icp world ≈ (686,371), rot world ≈ (741,339) — bow outward (right) -->
  <path d="M 686,371 Q 740,380 741,339" fill="none"
        stroke="#f43f5e" stroke-width="1.3" stroke-dasharray="3,2"
        marker-end="url(#rotArrow)" opacity="0.6"/>

  <!-- C: icp→rot -->
  <!-- icp world ≈ (480,735), rot world ≈ (480,767) — bow right -->
  <path d="M 480,735 Q 520,751 480,767" fill="none"
        stroke="#f43f5e" stroke-width="1.3" stroke-dasharray="3,2"
        marker-end="url(#rotArrow)" opacity="0.6"/>

  <!-- E: icp→rot1 -->
  <!-- icp world ≈ (274,371), rot1 world ≈ (247,355) — bow left -->
  <path d="M 274,371 Q 230,375 247,355" fill="none"
        stroke="#f43f5e" stroke-width="1.3" stroke-dasharray="3,2"
        marker-end="url(#rotArrow)" opacity="0.6"/>
  <!-- E: rot1→rot2 -->
  <!-- rot1 world ≈ (247,355), rot2 world ≈ (191,323) — bow left -->
  <path d="M 247,355 Q 190,350 191,323" fill="none"
        stroke="#f43f5e" stroke-width="1.3" stroke-dasharray="3,2"
        marker-end="url(#rotArrow)" opacity="0.6"/>

  <!-- ============================================================ -->
  <!-- Legend                                                         -->
  <!-- ============================================================ -->
  <g transform="translate(40,910)">
    <rect x="0" y="0" width="40" height="16" rx="3"
          fill="#2dd4bf" fill-opacity="0.3"/>
    <text x="20" y="12" text-anchor="middle" fill="#94e2d5"
          font-size="9">icp</text>
    <text x="48" y="12" fill="#a6adc8" font-size="10">inception</text>

    <rect x="130" y="0" width="40" height="16" rx="3"
          fill="#f43f5e" fill-opacity="0.3"/>
    <text x="150" y="12" text-anchor="middle" fill="#fda4af"
          font-size="9">rot</text>
    <text x="178" y="12" fill="#a6adc8" font-size="10">key rotation</text>

    <rect x="290" y="0" width="40" height="16" rx="3"
          fill="#6366f1" fill-opacity="0.3"/>
    <text x="310" y="12" text-anchor="middle" fill="#a5b4fc"
          font-size="9">ixn</text>
    <text x="338" y="12" fill="#a6adc8" font-size="10">interaction</text>

    <rect x="440" y="0" width="16" height="16" rx="3"
          fill="#f59e0b" fill-opacity="0.2" stroke="#f59e0b" stroke-width="1"/>
    <text x="464" y="12" fill="#a6adc8" font-size="10">sequencer</text>

    <rect x="540" y="0" width="16" height="16" rx="3"
          fill="#2dd4bf" fill-opacity="0.15" stroke="#2dd4bf" stroke-width="1"/>
    <text x="564" y="12" fill="#a6adc8" font-size="10">member</text>

    <line x1="620" y1="8" x2="660" y2="8"
          stroke="#6366f1" stroke-width="1.2" stroke-dasharray="5,3"
          marker-end="url(#arrow)"/>
    <text x="668" y="12" fill="#a6adc8" font-size="10">global seq</text>

    <path d="M 760,8 Q 775,0 790,8" fill="none"
          stroke="#f43f5e" stroke-width="1.3" stroke-dasharray="3,2"
          marker-end="url(#rotArrow)"/>
    <text x="800" y="12" fill="#a6adc8" font-size="10">key chain</text>
  </g>
</svg>
